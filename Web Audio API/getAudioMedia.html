<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>

    <canvas id="canvas"></canvas>
    <button onclick="GetUserMedia()">获取浏览器录音权限</button>
    <button onclick="openAudio()">获取浏览器录音权限</button>
    <h3 id="h3_device"></h3>
    <script>

        var h3_device = document.getElementById("h3_device");
        var message = ''

        //访问用户媒体设备的兼容方法
        //  navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia
        function getUserMedia(constrains, success, error) {
            if (navigator.mediaDevices.getUserMedia) {
                //最新标准API
                navigator.mediaDevices.getUserMedia(constrains).then(success).catch(error);
            } else if (navigator.webkitGetUserMedia) {
                //webkit内核浏览器
                navigator.webkitGetUserMedia(constrains).then(success).catch(error);
            } else if (navigator.mozGetUserMedia) {
                //Firefox浏览器
                navagator.mozGetUserMedia(constrains).then(success).catch(error);
            } else if (navigator.getUserMedia) {
                //旧版API
                navigator.getUserMedia(constrains).then(success).catch(error);
            }
        }

        function getMediaDevices() {
            if (!navigator.mediaDevices || !navigator.mediaDevices.enumerateDevices) {
                return console.log("不支持 enumerateDevices()， ");
            }

            navigator.mediaDevices.enumerateDevices().then(function (devices) {
                message = devices;
                console.log('当前可用的媒体设备如下: ', devices);
                devices.forEach(function (device) {
                    if (device.kind === "audioinput") {
                        // 音频输入设备
                        console.log(device.kind + ": " + device.label + " id = " + device.deviceId);
                    } else if (device.kind === "videoinput") {
                        // 视频输入设备
                        console.log(device.kind + ": " + device.label + " id = " + device.deviceId);
                    }
                });
            }).catch(function (err) {
                message = err
                console.error(err);
            }).finally(function () {
                h3_device.innerHTML = JSON.stringify(message);
            });
        };
        getMediaDevices();

        function GetUserMedia() {
            if (!navigator.mediaDevices || !navigator.mediaDevices.enumerateDevices) {
                return console.log("不支持 enumerateDevices()， ");
            } else {
                //调用用户媒体设备，访问摄像头
                getUserMedia({
                    audio: true,
                    // video: { width: 480, height: 320 }
                }, function (stream) {
                    // 成功的回调函数
                    h3_device.innerHTML = JSON.stringify(stream);
                }, function (error) {
                    console.log("访问用户媒体设备失败：", error);
                });
            }
        }       

        function openAudio() {
            try {
                globalThis.navigator.mediaDevices.getUserMedia({
                    video: true
                }).then((stream) => {
                    h3_device.innerHTML = JSON.stringify(stream);
                }).catch((err) => {
                    console.log(err);
                });
            } catch (error) {
                console.log(error);
            }
        }


    </script>
</body>

</html>